{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Offer Letter</title>

    <!-- html2pdf bundle includes html2canvas + jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @page { size: A4; margin: 0; }

        body {
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        .page-container {
            width: 210mm;
            margin: 0 auto;
            background: white;
            box-sizing: border-box;
        }

        /* Each visual page */
        .page {
            width: 210mm;
            min-height: 297mm; /* visual A4 height */
            padding: 15mm;
            margin: 0 auto;
            background: white;
            box-sizing: border-box;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 3px solid rgba(0,0,0,0.559);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .header .logo img { max-width: 110px; object-fit: contain; }
        .header .text { text-align: left; }
        .header .text h1 { font-size: 18px; margin: 0; }
        .header .text p { margin: 2px 0; font-size: 13px; text-align: left; }

        .content { flex: 1; font-size: 16px; line-height: 1.4; }
        .content h1 { font-size: 18px; text-align: center; margin: 15px 0; }
        .content p { margin: 8px 0; font-size: 16px; }
        .content ul, .content ol { margin: 8px 0; padding-left: 20px; }
        .content ul li, .content ol li { margin: 4px 0; font-size: 16px; }
        .content ol li { font-size: 14px; line-height: 1.3; margin: 6px 0; }

        .footer {
            position: absolute;
            bottom: 10mm;
            width: calc(100% - 30mm);
            text-align: center;
            font-size: 10px;
        }

        .signature { margin-top: 20px; text-align: right; }
        .signature p { margin: 5px 0; font-size: 16px; }
        .hr-sign { height: 55px; display: block; margin: 6px 0 -4px auto; }

        /* Download button */
        .download-button {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1000;
            font-family: Arial, sans-serif;
        }
        .download-button:hover { background-color: #0056b3; }

        @media print {
            .download-button { display: none; }
            body { background: white; }
        }

        /* Terms page tweaks */
        .terms-content { font-size: 14px; }
        .terms-content ol { padding-left: 18px; }
        .terms-content ol li { margin: 5px 0; line-height: 1.2; font-size: 14px; }
        .terms-title { font-weight: bold; font-size: 16px; margin-bottom: 10px; }

        /* Acceptance block */
        .acceptance-section {
            margin-top: 40px;
            border-top: 1px solid #000;
            padding-top: 20px;
        }
        .acceptance-section p { font-size: 16px; margin: 15px 0; }
    </style>
</head>
<body>
    <button class="download-button" onclick="downloadPDF()">Download PDF</button>

    <div id="pdf-content" class="page-container">
        <!-- Page 1 -->
        <div class="page">
            <div class="header">
                <div class="text">
                    <h1>IMCB SOLUTIONS LLP</h1>
                    <p><i class="fa fa-map-marker" style="color:black; margin-right:5px;"></i> Palakkunnummal Building, Kalpetta, Wayanad-673121</p>
                    <p><i class="fa fa-phone" style="color:black; margin-right:4px;"></i> +91 8129191379</p>
                    <p>
                        <i class="fa fa-globe" style="color:black; margin-right:5px;"></i> www.imcbs.com
                        <span style="margin-left: 2%;">
                            <i class="fa fa-envelope" style="color:black; margin-right:5px;"></i> info@imcbs.com
                        </span>
                    </p>
                </div>
            </div>

            <div class="content">
                <p style="display:flex; justify-content:end;">{{ today_date }}</p>
                <p>Mr/Ms <strong>{{ candidate_name }}</strong></p>
                <p style="white-space: pre-line;">{{ candidate_address }}</p>
                <p>{{ candidate_phone }}</p>
                <h1>JOB OFFER LETTER</h1>
                <p>Dear <strong>{{ candidate_name }}</strong>,</p>
                <p style="text-indent:35px; text-align:justify;">
                    We are pleased to offer you the position of
                    {% if offer_letter_details %}{{ offer_letter_details.position }}{% endif %}
                    at IMCB SOLUTIONS LLP. We were thoroughly impressed by your qualifications, experience,
                    and interview performance, and we believe you will make a valuable addition to our team.
                </p>
                <p>Job Details:</p>
                <ul>
                    <div style="margin-top: 4%;">
                        <li><span style="font-weight:bold;">Job Title:</span> {% if offer_letter_details %}{{ offer_letter_details.position }}{% endif %}</li>
                        <li><span style="font-weight:bold;">Department:</span> {% if offer_letter_details %}{{ offer_letter_details.department }}{% endif %}</li>
                        <li>
  <span style="font-weight:bold;">Reporting to:</span>
  <p style="display:inline;">Merin Devasia (HR & Office Administrator)</p>
</li>
                        <li><span style="font-weight:bold;">Start Date:</span> {% if offer_letter_details %}{{ offer_letter_details.start_date|date:"d/m/Y" }}{% endif %}</li>
                        <li><span style="font-weight:bold;">Timing:</span>
                            {% if offer_letter_details %}
                                {{ offer_letter_details.start_time|time:"h:i A" }} to {{ offer_letter_details.end_time|time:"h:i A" }}
                            {% else %}
                                9.30 Am to 5.30 Pm
                            {% endif %}
                        </li>
                        <li><span style="font-weight:bold;">Salary:</span>
                            INR.{% if offer_letter_details %}{{ offer_letter_details.salary }}{% endif %}/- Month
                            (Salary Hike will be considered purely based on performance and Expertise)
                        </li>
                    </div>
                </ul>
                <div class="signature">
                    <p>Sincerely,</p>
                    <img src="{% static 'images/HR_SIGN.png' %}" alt="HR Signature" class="hr-sign"/>
                    <p style="margin-top:10px;">Merin Devasia</p>
                    <p>HR & Office Administrator</p>
                </div>
            </div>
            <div class="footer"><p>1 | P a g e</p></div>
        </div>

        <!-- Page 2 -->
        <div class="page">
            <div class="header">
                <div class="text">
                    <h1>IMCB SOLUTIONS LLP</h1>
                    <p><i class="fa fa-map-marker" style="color:black; margin-right:5px;"></i> Palakkunnummal Building, Kalpetta, Wayanad-673121</p>
                    <p><i class="fa fa-phone" style="color:black; margin-right:4px;"></i> +91 8129191379</p>
                    <p>
                        <i class="fa fa-globe" style="color:black; margin-right:5px;"></i> www.imcbs.com
                        <span style="margin-left: 2%;">
                            <i class="fa fa-envelope" style="color:black; margin-right:5px;"></i> info@imcbs.com
                        </span>
                    </p>
                </div>
            </div>

            <div class="content terms-content">
                <div class="terms-title">Terms & Conditions:</div>
                <ol>
                    <li><strong>Company Rules and Regulations:</strong> The Company's rules and regulations are subject to change from time to time. The rules mentioned at present may not be permanent, and updates may be implemented as per management's discretion. All employees are required to comply with the latest policies as communicated by the Company.</li>
                    <li>You are required to adhere to the rules and standards of this office, including behavior, dress code, and punctuality.</li>
                    <li><strong>Salary Settlement on Resignation:</strong> In the event of resignation, the final salary will be processed and paid at the beginning of the following month after the employee's last working day.</li>
                    <li><strong>Notice Period Policy:</strong> If an employee resigns, they must complete the required notice period as per Company policy. Upon successful completion of the notice period, the Company will provide both the final salary and the experience certificate. If the notice period is not completed: The Company will not issue the experience certificate. The final salary will be paid only for the days worked, and will be processed at the end of the month. If an employee has not completed the notice period but still requests the experience certificate, they must pay an amount equivalent to one month's salary to the Company.</li>
                    <li><strong>Leave and Attendance Policy:</strong> Employee attendance will be recorded and calculated in accordance with the Company's policy. Early leave requests and late arrival requests will be monitored. If such requests are made frequently or continuously, the Company reserves the right to deduct half-day or full-day salary based on time calculations. All details regarding leave and attendance are maintained by the HR team.</li>
                    <li><strong>Workplace Harassment Policy:</strong> Any act of abuse, harassment, or misconduct towards any colleague, regardless of gender, will result in immediate disciplinary action, which may include legal proceedings as per applicable laws.</li>
                    <li><strong>Performance and Termination Policy:</strong> If an employee's performance does not meet the Company's expectations, a warning will be issued. If there is no improvement after such a warning, the Company reserves the right to terminate employment without further notice.</li>
                    <li>If you have to resign from this office under any circumstances, work at least </span> {% if offer_letter_details %}{{ offer_letter_details.notice_period }}{% else %}0{% endif %} days notice period.</li>
                    <li>If an employee resigns within 6 months of receiving the uniform, the cost of the uniform will be deducted from their final month's salary.</li>
                    <li>All leave requests, late requests, and early requests must be applied at least 3 days in advance and can only be taken after receiving prior approval. Exceptions may be made for bereavement leave and health emergencies; however, approval is still required in such cases also. Taking leave without approval will result in a deduction of 2 days’ salary.</li>
                </ol>

                <div class="signature" style="margin-top: 15px;">
                    <p>Sincerely,</p>
                    <img src="{% static 'images/HR_SIGN.png' %}" alt="HR Signature" class="hr-sign"/>
                    <p style="margin-top:10px;">Merin Devasia</p>
                    <p>HR & Office Administrator</p>
                </div>
            </div>
            <div class="footer"><p>2 | P a g e</p></div>
        </div>

        <!-- Page 3 -->
        <div class="page">
            <div class="header">
                <div class="text">
                    <h1>IMCB SOLUTIONS LLP</h1>
                    <p><i class="fa fa-map-marker" style="color:black; margin-right:5px;"></i> Palakkunnummal Building, Kalpetta, Wayanad-673121</p>
                    <p><i class="fa fa-phone" style="color:black; margin-right:4px;"></i> +91 8129191379</p>
                    <p>
                        <i class="fa fa-globe" style="color:black; margin-right:5px;"></i> www.imcbs.com
                        <span style="margin-left: 2%;">
                            <i class="fa fa-envelope" style="color:black; margin-right:5px;"></i> info@imcbs.com
                        </span>
                    </p>
                </div>
            </div>

            <div class="content">
                <div style="margin-top: 5%;">
                    <p>We are excited to have you join our team and look forward to your contributions.</p>
                    <p>We would like you to start work on {% if offer_letter_details %}{{ offer_letter_details.start_date|date:"d/m/Y" }}{% endif %} at 9.30 Am. Please report to Ms Merin Devasia, HR and Office Administrator, for documentation and orientation. If this date is not acceptable, please contact me immediately.</p>
                    <p>Please sign the enclosed copy of this letter and return it to me by {% if offer_letter_details %}{{ offer_letter_details.start_date|date:"d/m/Y" }}{% endif %} to indicate your acceptance of this offer.</p>
                    <p>We are confident you will be able to make a significant contribution to the success of our Company and look forward to working with you.</p>
                </div>

                <div class="acceptance-section">
                    <p><strong>ACCEPTANCE OF OFFER:</strong></p>
                    <p>I, <strong>{{ candidate_name }}</strong>, hereby accept the above offer of employment with IMCB SOLUTIONS LLP under the terms and conditions mentioned in this letter.</p>

                    <div style="margin-top:50px;">
                        <div style="display:flex; justify-content:space-between;">
                            <div>
                                <p>Employee Signature: _______________________</p>
                                <p>Date: _______________________</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="signature" style="margin-top:30px;">
                    <p>Sincerely,</p>
                    <img src="{% static 'images/HR_SIGN.png' %}" alt="HR Signature" class="hr-sign"/>
                    <p style="margin-top:10px;">Merin Devasia</p>
                    <p>HR & Office Administrator</p>
                </div>
            </div>
            <div class="footer"><p>3 | P a g e</p></div>
        </div>
    </div>

    <script>
    async function downloadPDF() {
        const button = document.querySelector('.download-button');
        button.style.display = 'none';

        const pages = document.querySelectorAll('#pdf-content .page');

        // jsPDF is exposed by the bundle as window.jspdf.jsPDF
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({ unit: 'mm', format: 'a4', orientation: 'portrait' });

        for (let i = 0; i < pages.length; i++) {
            const node = pages[i];

            // Render each page to canvas and add as full-bleed image
            const canvas = await html2canvas(node, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff',
                logging: false
            });

            const imgData = canvas.toDataURL('image/jpeg', 0.98);
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();

            if (i > 0) pdf.addPage();
            pdf.addImage(imgData, 'JPEG', 0, 0, pageWidth, pageHeight);
        }

        pdf.save('offer-letter.pdf');
        button.style.display = 'block';
    }
    </script>
</body>
</html>
