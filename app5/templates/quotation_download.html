<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotation – {{ quotation_number }}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ====================================================
           RESET & BASE - Improved for cross-browser consistency
           ==================================================== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 20px;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
            color-adjust: exact !important;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            width: 100%;
        }

        /* ── print-control bar (hidden in print) ── */
        .print-controls {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,.08);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .controls-left h1 {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls-left h1 i { 
            color: #3498db; 
        }
        
        .controls-right { 
            display: flex; 
            gap: 12px; 
            flex-wrap: wrap; 
        }

        /* ── buttons ── */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all .3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            min-width: 120px;
            justify-content: center;
        }
        
        .btn-primary { 
            background: linear-gradient(135deg,#3498db,#2980b9); 
            color: #fff; 
        }
        
        .btn-primary:hover { 
            background: linear-gradient(135deg,#2980b9,#2573a7); 
            transform: translateY(-2px); 
            box-shadow: 0 6px 15px rgba(52,152,219,.3); 
        }
        
        .btn-success { 
            background: linear-gradient(135deg,#2ecc71,#27ae60); 
            color: #fff; 
        }
        
        .btn-success:hover { 
            background: linear-gradient(135deg,#27ae60,#219653); 
            transform: translateY(-2px); 
            box-shadow: 0 6px 15px rgba(46,204,113,.3); 
        }
        
        .btn-secondary { 
            background: linear-gradient(135deg,#95a5a6,#7f8c8d); 
            color: #fff; 
        }
        
        .btn-secondary:hover { 
            background: linear-gradient(135deg,#7f8c8d,#718093); 
            transform: translateY(-2px); 
            box-shadow: 0 6px 15px rgba(149,165,166,.3); 
        }

        /* ====================================================
           QUOTATION WRAPPER
           ==================================================== */
        .quotation-container {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        /* ====================================================
           PAGE STRUCTURE - 3 Pages with Dotted Separators
           ==================================================== */
        .page {
            min-height: 100vh;
            padding: 30px 40px;
            background: #fff;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .page-1, .page-2 {
            page-break-after: always;
            border-bottom: 2px dotted #999;
            margin-bottom: 20px;
            padding-bottom: 30px;
        }
        
        .page-3 {
            page-break-after: auto;
        }

        /* Dotted page separator (visible only on screen) */
        .page-separator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0 20px 0;
            color: #999;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .page-separator .line {
            flex: 1;
            height: 2px;
            background: repeating-linear-gradient(
                90deg,
                #999,
                #999 5px,
                transparent 5px,
                transparent 10px
            );
            margin: 0 15px;
        }
        
        .page-separator i {
            color: #3498db;
            font-size: 18px;
        }

        /* Hide separators in print */
        @media print {
            .page-1, .page-2 {
                border-bottom: none;
                margin-bottom: 0;
                padding-bottom: 0;
            }
            .page-separator {
                display: none !important;
            }
        }

        /* ====================================================
           CONSISTENT HEADER FOR ALL PAGES
           ==================================================== */
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 3px solid #050505;
            margin-bottom: 20px;
            page-break-inside: avoid;
        }

        /* ✅ CONSISTENT LOGO SIZE FOR ALL PAGES */
        .page-logo {
            width: 220px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            color: #3498db;
            font-size: 38px;
            flex-shrink: 0;
            padding: 8px;
            overflow: hidden;
            background: #fff;
        }
        
        .page-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }
        
        /* ✅ Show icon only when no logo */
        .page-logo.no-logo {
            background: linear-gradient(135deg,#3498db,#2980b9);
            color: #fff;
        }

        .page-header-content {
            flex: 1;
            text-align: right;
        }
        
        .page-header-content .website {
            color: #3498db;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .page-header-content h1 {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .page-header-content p {
            color: #555;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 6px;
            font-size: 13px;
        }

        /* Address container for 3-line display */
        .address-container {
            text-align: right;
            margin-bottom: 5px;
        }
        
        .address-container p {
            margin-bottom: 2px;
            white-space: nowrap;
            font-size: 13px;
        }

        /* ====================================================
           PAGE 1 – COVER LETTER (IMC-style)
           ==================================================== */
        .page-1-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .client-info-box {
            background: #f8f9fa;
            padding: 18px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .client-info-box p { 
            margin-bottom: 4px; 
            font-size: 14px;
        }
        
        .client-info-box strong {
            color: #2c3e50;
            font-size: 15px;
        }

        .salutation-box {
            margin: 15px 0;
            text-align: center;
        }
        
        .salutation-box p {
            color: #b45f06;
            font-size: 22px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .greeting-box {
            margin: 15px 0;
            font-weight: 600;
            font-size: 17px;
        }

        .letter-content {
            margin: 15px 0;
            line-height: 1.7;
            font-size: 15px;
            text-align: justify;
            padding: 0 15px;
            flex: 1;
        }
        
        .letter-content p { 
            margin-bottom: 15px; 
        }

        .date-place-box {
            margin-top: 20px;
            border-top: 2px solid #090909;
            padding-top: 15px;
            font-size: 15px;
            line-height: 1.6;
        }

        /* ====================================================
           PAGE 2 – QUOTATION DETAILS (Single Page Optimized)
           ==================================================== */
        .page-2-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* ── customer info box (compact) ── */
        .customer-info-box {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 6px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .customer-info-box h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
        }

        .customer-details-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .customer-detail-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .customer-detail-item strong {
            color: #555;
            font-size: 13px;
            min-width: 55px;
        }

        .customer-detail-item span {
            color: #2c3e50;
            font-size: 14px;
            font-weight: 500;
        }

        /* ── items section (compact) ── */
        .items-section {
            margin: 10px 0;
            flex: 1;
        }

        .section-title {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 6px;
        }

        .table-wrapper {
            overflow-x: auto;
            margin-bottom: 10px;
            max-height: 350px;
            overflow-y: auto;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            table-layout: fixed;
        }

        .items-table colgroup col:nth-child(1) { width: 5%; }
        .items-table colgroup col:nth-child(2) { width: 38%; }
        .items-table colgroup col:nth-child(3) { width: 7%; }
        .items-table colgroup col:nth-child(4) { width: 10%; }
        .items-table colgroup col:nth-child(5) { width: 7%; }
        .items-table colgroup col:nth-child(6) { width: 10%; }
        .items-table colgroup col:nth-child(7) { width: 10%; }

        .items-table thead {
            background: #3498db;
            color: white;
        }

        .items-table th {
            padding: 8px 5px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
        }

        .items-table th.text-center { text-align: center; }
        .items-table th.text-right { text-align: right; }

        .items-table tbody tr {
            border-bottom: 1px solid #e9ecef;
        }

        .items-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .items-table td {
            padding: 6px 5px;
            word-wrap: break-word;
            font-size: 12px;
        }

        .items-table td.text-center { text-align: center; }
        .items-table td.text-right { text-align: right; }

        .item-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 12px;
        }

        .item-description {
            font-size: 10px;
            color: #7f8c8d;
            margin-top: 2px;
        }

        /* ── totals section (compact) ── */
        .totals-section {
            display: flex;
            justify-content: flex-end;
            margin: 10px 0;
        }

        .totals-table {
            width: 320px;
            font-size: 13px;
            border-collapse: collapse;
        }

        .totals-table tr {
            border-bottom: 1px solid #e9ecef;
        }

        .totals-table td {
            padding: 5px 0;
        }

        .totals-label {
            text-align: right;
            color: #555;
            font-weight: 500;
            padding-right: 12px;
        }

        .totals-value {
            text-align: right;
            font-weight: 600;
            color: #2c3e50;
            min-width: 90px;
        }

        .grand-total-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            gap: 15px;
            margin: 10px 0;
        }

        .amount-in-words-box {
            flex: 1;
            
            padding: 8px 12px;
            border-radius: 5px;
            
        }

        .amount-in-words-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 3px;
            font-size: 12px;
        }

        #amountInWords {
            font-style: italic;
            color: #2c3e50;
            font-size: 11px;
            line-height: 1.4;
        }

        .grand-total-number-box {
            text-align: right;
            
            color: rgb(3, 3, 3);
            padding: 8px 15px;
            border-radius: 5px;
            min-width: 130px;
        }

        .grand-total-number-box .label {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 2px;
        }

        .grand-total-number-box .amount {
            font-weight: 700;
            font-size: 18px;
        }

        /* ── notes section (compact) ── */
        .notes-section {
            margin-top: 10px;
        }

        .notes-box {
            
            padding: 10px 15px;
            border-radius: 5px;
           
        }

        .notes-box h4 {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #2c3e50;
            font-size: 14px;
        }

        .notes-content {
            color: #555;
            line-height: 1.5;
            font-size: 12px;
        }

        /* ====================================================
           PAGE 3 – TERMS & CONDITIONS (Single Page)
           ==================================================== */
        .page-3-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .client-summary {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 13px;
            border: 1px solid #e0e0e0;
        }

        .terms-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .terms-content h2 {
            font-size: 20px;
            color: #2c3e50;
            margin: 0 0 15px 0;
            text-align: center;
            text-transform: uppercase;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .terms-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
            flex: 1;
        }

        .term-item {
            margin-bottom: 3px;
        }

        .term-item h3 {
            font-size: 16px;
            color: #e38c5f;
            margin: 0 0 3px 20px;
            font-weight: 600;
        }

        .term-item p {
            color: #555;
            font-size: 13px;
            margin: 0 0 0 35px;
            text-align: justify;
            line-height: 1.5;
            padding-right: 15px;
        }

        .terms-footer {
            margin-top: 15px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            font-size: 12px;
            color: #7f8c8d;
        }

        .terms-footer p {
            margin-bottom: 3px;
        }

        /* ====================================================
           PRINT STYLES - Optimized for all browsers
           ==================================================== */
        @media print {
            @page {
                size: A4;
                margin: 1cm;
            }
            
            body {
                background: #fff;
                padding: 0;
                margin: 0;
                font-size: 10pt;
            }

            .print-controls {
                display: none !important;
            }

            .quotation-container {
                box-shadow: none;
                border-radius: 0;
                margin: 0;
                padding: 0;
            }

            .page {
                padding: 0.4cm !important;
                min-height: 100vh;
                page-break-inside: avoid;
                border-bottom: none !important;
                margin-bottom: 0 !important;
                padding-bottom: 0 !important;
            }
            
            .page-1, .page-2 {
                page-break-after: always !important;
                border-bottom: none !important;
            }
            
            .page-3 {
                page-break-after: auto !important;
                page-break-before: always !important;
            }

            /* Consistent header sizing for print */
            .page-logo {
                width: 160px !important;
                height: 80px !important;
                font-size: 28px !important;
            }
            
            .page-header-content h1 {
                font-size: 18pt !important;
            }
            
            .page-header-content p,
            .address-container p {
                font-size: 9pt !important;
                margin-bottom: 1px !important;
            }
            
            .page-header-content .website {
                font-size: 10pt !important;
            }

            /* Table styles for print */
            .table-wrapper {
                max-height: none !important;
                overflow: visible !important;
            }
            
            .items-table {
                font-size: 9pt;
            }
            
            .items-table th {
                background: #3498db !important;
                color: white !important;
                padding: 4px 3px;
                font-size: 8pt;
            }
            
            .items-table td {
                padding: 3px 3px;
                border-bottom: 1px solid #ddd;
                font-size: 8pt;
            }
            
            .item-name {
                font-size: 8pt;
            }
            
            .item-description {
                font-size: 7pt;
            }
            
            /* Totals in print */
            .totals-table {
                font-size: 9pt;
            }
            
            .totals-table td {
                padding: 3px 0;
            }
            
            .grand-total-number-box {
                padding: 5px 10px;
            }
            
            .grand-total-number-box .amount {
                font-size: 14pt;
            }
            
            #amountInWords {
                font-size: 8pt;
            }
            
            /* Terms page print */
            .terms-content h2 {
                font-size: 14pt;
                margin: 0 0 10px;
            }
            
            .term-item h3 {
                font-size: 12pt;
                margin-left: 10px;
            }
            
            .term-item p {
                font-size: 9pt;
                margin-left: 25px;
                margin-right: 10px;
                line-height: 1.3;
            }
            
            .terms-footer {
                font-size: 8pt;
                margin-top: 10px;
                padding-top: 8px;
            }
            
            /* Force all content to stay on respective pages */
            .page-2 {
                page-break-after: always !important;
                max-height: 100vh;
                overflow: hidden;
            }
            
            .page-2-content {
                max-height: 95vh;
            }
            
            /* Force background colors to print */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }
        
        /* ====================================================
           RESPONSIVE STYLES
           ==================================================== */
        @media screen and (max-width: 992px) {
            .page {
                padding: 20px;
            }
            
            .grand-total-wrapper {
                flex-direction: column;
                gap: 10px;
            }
            
            .amount-in-words-box {
                width: 100%;
            }
            
            .grand-total-number-box {
                width: 100%;
                text-align: center;
            }
            
            .term-item p {
                margin-left: 25px;
                margin-right: 5px;
            }
        }
        
        @media screen and (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .page-header-content {
                text-align: center;
                margin-top: 15px;
            }
            
            .page-header-content p,
            .address-container {
                justify-content: center;
                text-align: center;
            }
            
            .customer-details-grid {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .term-item h3 {
                margin-left: 10px;
            }
            
            .term-item p {
                margin-left: 20px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- ============================================================
         PRINT CONTROLS (hidden in print)
         ============================================================ -->
    <div class="print-controls">
        <div class="controls-left">
            <p style="color:#7f8c8d; font-size:14px;">
                {{ company_name }} | Valid Until: {{ valid_until }}
            </p>
        </div>
        <div class="controls-right">
            <button onclick="window.print()" class="btn btn-primary">
                <i class="fas fa-print"></i>
                Print
            </button>
            <button onclick="window.print()" class="btn btn-success">
                <i class="fas fa-download"></i>
                Save as PDF
            </button>
            <a href="{% url 'app5:quotation_form' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i>
                Back to List
            </a>
        </div>
    </div>

    <div class="quotation-container">
        <!-- ================================================
             PAGE 1 – COVER LETTER
             ================================================ -->
        <div class="page page-1">
            <div class="page-1-content">
                <!-- Header -->
                <div class="page-header">
                    <div class="page-logo {% if not company_has_logo %}no-logo{% endif %}">
                        {% if company_has_logo %}
                            <img src="{{ company_logo_url }}" alt="{{ company_name }} Logo">
                        {% else %}
                            <i class="fas fa-building"></i>
                        {% endif %}
                    </div>

                    <div class="page-header-content">
                        {% if company_email %}
                        <div class="website">{{ company_email }}</div>
                        {% endif %}
                        <h1>{{ company_name }}</h1>
                        <div class="address-container" data-address="{{ company_address }}"></div>
                        {% if company_contact %}
                        <p><i class="fas fa-phone"></i> {{ company_contact }}</p>
                        {% endif %}
                        {% if company_gst %}
                        <p><i class="fas fa-file-invoice"></i> GST: {{ company_gst }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Client Info -->
                <div class="client-info-box">
                    <p><strong>{{ client_name|default:"Valued Customer" }}</strong></p>
                    {% if lead_data.customerType == 'Business' %}
                        <p>{{ lead_data.place|default:"Address not provided" }}</p>
                    {% else %}
                        <p>{{ lead_data.individualPlace|default:"Address not provided" }}</p>
                    {% endif %}
                    {% if client_phone %}
                    <p>{{ client_phone }}</p>
                    {% endif %}
                </div>
                
                <!-- Salutation -->
                <div class="salutation-box">
                    <p>Warm Greetings From {{ company_name }}</p>
                </div>

                <!-- Greeting -->
                <div class="greeting-box">
                    <p>Sir {{ client_name|default:"Valued Customer" }},</p>
                </div>

                <!-- Letter Content -->
                <div class="letter-content">
                    <p>
                        Thank you for the time you have given in allowing us to discuss with you the opportunity
                        how our software may assist your organization further progressing your productivity and
                        outputs. As agreed, we are submitting to you information about us and our proposed plan
                        to action for your review.
                    </p>

                    <p>
                        IMC Business Solutions is a comprehensive platform that supports overall Business
                        solutions like ERP Softwares, Web Solutions, Mobile Applications, Digital Marketing,
                        Branding, and Business Consultation.
                    </p>

                    <p>
                        Here we are attaching the detailed quotation. We are expecting to have a journey together
                        to reach your success.
                    </p>
                </div>

                <!-- Date and Place -->
                <div class="date-place-box">
                    <div><strong>Date:</strong> {{ created_date|date:"d M Y"|default:"Date not specified" }}</div>
                    <div><strong>Place:</strong> Kalpetta</div>
                </div>
            </div>
        </div>

        <!-- Dotted Page Separator -->
        

        <!-- ================================================
             PAGE 2 – QUOTATION DETAILS (Single Page)
             ================================================ -->
        <div class="page page-2">
            <div class="page-2-content">
                <!-- Header -->
                <div class="page-header">
                    <div class="page-logo {% if not company_has_logo %}no-logo{% endif %}">
                        {% if company_has_logo %}
                            <img src="{{ company_logo_url }}" alt="{{ company_name }} Logo">
                        {% else %}
                            <i class="fas fa-building"></i>
                        {% endif %}
                    </div>

                    <div class="page-header-content">
                        {% if company_email %}
                        <div class="website">{{ company_email }}</div>
                        {% endif %}
                        <h1>{{ company_name }}</h1>
                        <div class="address-container" data-address="{{ company_address }}"></div>
                        {% if company_contact %}
                        <p><i class="fas fa-phone"></i> {{ company_contact }}</p>
                        {% endif %}
                        {% if company_gst %}
                        <p><i class="fas fa-file-invoice"></i> GST: {{ company_gst }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Customer Info Box -->
                <div class="customer-info-box">
                    <h3><i class="fas fa-user-circle"></i> Customer Details</h3>
                    <div class="customer-details-grid">
                        <div class="customer-detail-item">
                            <strong>Name:</strong>
                            <span>{{ client_name|default:"Not Specified" }}</span>
                        </div>

                        <div class="customer-detail-item">
                            <strong>Address:</strong>
                            <span>
                                {% if lead_data.customerType == 'Business' %}
                                    {{ lead_data.place|default:"Not provided" }}
                                {% else %}
                                    {{ lead_data.individualPlace|default:"Not provided" }}
                                {% endif %}
                            </span>
                        </div>
                        
                        {% if client_phone %}
                        <div class="customer-detail-item">
                            <strong>Phone:</strong>
                            <span>{{ client_phone }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Items Table -->
                <div class="items-section">
                    <h2 class="section-title"><i class="fas fa-list-ul"></i> Items & Services</h2>

                    <div class="table-wrapper">
                        <table class="items-table">
                            <colgroup>
                                <col>
                                <col>
                                <col>
                                <col>
                                <col>
                                <col>
                                <col>
                            </colgroup>
                            <thead>
                                <tr>
                                    <th class="text-center">Sl.No</th>
                                    <th>Item Description</th>
                                    <th class="text-center">Qty</th>
                                    <th class="text-right">Rate (₹)</th>
                                    <th class="text-right">Tax %</th>
                                    <th class="text-right">Tax (₹)</th>
                                    <th class="text-right">Amount (₹)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in items %}
                                <tr>
                                    <td class="text-center">{{ forloop.counter }}</td>
                                    <td>
                                        <div class="item-name">{{ item.item_name }}</div>
                                        {% if item.description %}
                                        <div class="item-description">{{ item.description|truncatechars:40 }}</div>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">{{ item.quantity }}</td>
                                    <td class="text-right">{{ item.sales_price|floatformat:2 }}</td>
                                    <td class="text-right">{{ item.tax_percentage|floatformat:2 }}%</td>
                                    <td class="text-right">{{ item.tax_amount|floatformat:2 }}</td>
                                    <td class="text-right">{{ item.line_total|floatformat:2 }}</td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="7" class="text-center">No items added to this quotation</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Totals Section -->
                    <div class="totals-section">
                        <table class="totals-table">
                            <tr>
                                <td class="totals-label">Subtotal:</td>
                                <td class="totals-value">₹{{ subtotal }}</td>
                            </tr>
                            <tr>
                                <td class="totals-label">Total Tax:</td>
                                <td class="totals-value">₹{{ total_tax }}</td>
                            </tr>
                            <tr>
                                <td class="totals-label">Discount:</td>
                                <td class="totals-value">-₹{{ discount_amount }}</td>
                            </tr>
                            {% if shipping_charges %}
                            <tr>
                                <td class="totals-label">Shipping:</td>
                                <td class="totals-value">₹{{ shipping_charges }}</td>
                            </tr>
                            {% endif %}
                        </table>
                    </div>

                    <!-- Grand Total -->
                    <div class="grand-total-wrapper">
                        <div class="amount-in-words-box">
                            <div class="amount-in-words-label">Grand Total (in words):</div>
                            <div id="amountInWords">Calculating...</div>
                        </div>
                        <div class="grand-total-number-box">
                            <div class="label">Grand Total</div>
                            <div class="amount">₹{{ grand_total }}</div>
                        </div>
                    </div>

                    <!-- Notes Section -->
                    {% if quotation.notes %}
                    <div class="notes-section">
                        <div class="notes-box">
                            <h4><i class="fas fa-sticky-note"></i> Notes</h4>
                            <div class="notes-content">{{ quotation.notes|linebreaks }}</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Dotted Page Separator -->
       

        <!-- ================================================
             PAGE 3 – TERMS & CONDITIONS (Single Page)
             ================================================ -->
        <div class="page page-3">
            <div class="page-3-content">
                <!-- Header -->
                <div class="page-header">
                    <div class="page-logo {% if not company_has_logo %}no-logo{% endif %}">
                        {% if company_has_logo %}
                            <img src="{{ company_logo_url }}" alt="{{ company_name }} Logo">
                        {% else %}
                            <i class="fas fa-building"></i>
                        {% endif %}
                    </div>

                    <div class="page-header-content">
                        <h1>{{ company_name }}</h1>
                        <div class="address-container" data-address="{{ company_address }}"></div>
                        {% if company_contact %}
                        <p><i class="fas fa-phone"></i> {{ company_contact }}</p>
                        {% endif %}
                        {% if company_email %}
                        <p><i class="fas fa-envelope"></i> {{ company_email }}</p>
                        {% endif %}
                        {% if company_gst %}
                        <p><i class="fas fa-file-invoice"></i> GST: {{ company_gst }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Client Summary -->
                <div class="client-summary">
                    <strong>Customer:</strong> {{ client_name|default:"Not Specified" }}
                    {% if client_phone %} | <strong>Phone:</strong> {{ client_phone }}{% endif %}
                    {% if lead_data.customerType == 'Business' %}
                        | <strong>Address:</strong> {{ lead_data.place|default:"Not provided" }}
                    {% else %}
                        | <strong>Address:</strong> {{ lead_data.individualPlace|default:"Not provided" }}
                    {% endif %}
                </div>

                <!-- Terms Content -->
                <div class="terms-content">
                    <h2>TERMS AND CONDITIONS</h2>
                    
                    <div class="terms-list">
                        <div class="term-item">
                            <h3>1. Scope of Services:</h3>
                            <p>{{ company_name }} provides various types of services to clients based on their requirements. The specific services will be detailed in the service agreement.</p>
                        </div>

                        <div class="term-item">
                            <h3>2. Payment Terms:</h3>
                            <p>Payment for services will be made according to the agreed-upon schedule. An advance of 50% is required upon order confirmation, with the balance due upon completion of services. If you are not satisfied with your purchase, you may request a full refund within 10 days.</p>
                        </div>

                        <div class="term-item">
                            <h3>3. Confidentiality:</h3>
                            <p>Both parties agree to keep all information shared during the course of the agreement confidential. This includes client data, marketing strategies, and any proprietary information.</p>
                        </div>

                        <div class="term-item">
                            <h3>4. Warranty and Limitation of Liability:</h3>
                            <p>{{ company_name }} warrants that its services will be performed in a professional and workmanlike manner. However, the company is not liable for any indirect, incidental, or consequential damages.</p>
                        </div>

                        <div class="term-item">
                            <h3>5. Termination:</h3>
                            <p>Either party may terminate the agreement with written notice. In the event of termination, the client will be responsible for any unpaid fees for services rendered up to the termination date.</p>
                        </div>

                        <div class="term-item">
                            <h3>6. Governing Law:</h3>
                            <p>These terms and conditions are governed by the laws of the jurisdiction in which the company operates. The company reserves the right to modify these terms and conditions at any time. Clients will be notified of any changes.</p>
                        </div>
                    </div>

                    <div class="terms-footer">
                        <p>This is a computer generated quotation and does not require signature.</p>
                        <p>Thank you for your business!</p>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- /quotation-container -->
</div><!-- /container -->

<!-- ============================================================
     JAVASCRIPT  –  Number to words conversion & Address split
     ============================================================ -->
<script>
// Function to convert number to words (Indian Numbering System)
function numberToWords(num) {
    const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
    const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
    const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
    
    if (num === 0) return 'Zero';
    
    let rupees = Math.floor(num);
    let paise = Math.round((num - rupees) * 100);
    
    function convertLessThanThousand(n) {
        if (n === 0) return '';
        if (n < 10) return ones[n];
        if (n < 20) return teens[n - 10];
        if (n < 100) return tens[Math.floor(n / 10)] + (n % 10 !== 0 ? ' ' + ones[n % 10] : '');
        return ones[Math.floor(n / 100)] + ' Hundred' + (n % 100 !== 0 ? ' and ' + convertLessThanThousand(n % 100) : '');
    }
    
    function convertIndian(num) {
        let result = '';
        let crore = Math.floor(num / 10000000);
        num %= 10000000;
        let lakh = Math.floor(num / 100000);
        num %= 100000;
        let thousand = Math.floor(num / 1000);
        num %= 1000;
        
        if (crore > 0) result += convertLessThanThousand(crore) + ' Crore ';
        if (lakh > 0) result += convertLessThanThousand(lakh) + ' Lakh ';
        if (thousand > 0) result += convertLessThanThousand(thousand) + ' Thousand ';
        if (num > 0) result += convertLessThanThousand(num);
        
        return result.trim();
    }
    
    let words = rupees > 0 ? convertIndian(rupees) : '';
    let result = words ? 'Rupees ' + words : '';
    
    if (paise > 0) {
        result += (result ? ' and ' : '') + convertLessThanThousand(paise) + ' Paise';
    }
    
    return result ? result + ' Only' : 'Rupees Zero Only';
}

// Extract grand total and update words
function updateAmountInWords() {
    const grandTotalAmount = document.querySelector('.grand-total-number-box .amount');
    if (grandTotalAmount) {
        const text = grandTotalAmount.textContent.trim();
        const numericValue = parseFloat(text.replace(/[^0-9.]/g, ''));
        
        if (!isNaN(numericValue)) {
            const words = numberToWords(numericValue);
            const amountInWordsElement = document.getElementById('amountInWords');
            if (amountInWordsElement) {
                amountInWordsElement.textContent = words;
            }
        }
    }
}

// Function to split address into exactly 3 lines
function splitAddressIntoLines() {
    const addressContainers = document.querySelectorAll('.address-container');
    
    addressContainers.forEach(container => {
        const fullAddress = container.getAttribute('data-address');
        
        if (fullAddress && fullAddress.trim()) {
            const addressText = fullAddress.trim();
            
            // Create an array to hold the 3 lines
            let addressLines = ['', '', ''];
            
            if (addressText.includes(',')) {
                const parts = addressText.split(',').map(part => part.trim());
                
                // Assign to lines (max 3)
                for (let i = 0; i < Math.min(parts.length, 3); i++) {
                    addressLines[i] = parts[i];
                }
                
                // If we have more than 3 parts, combine remaining into the last line
                if (parts.length > 3) {
                    addressLines[2] = parts.slice(2).join(', ');
                }
            } else {
                // If no commas, split by words to create 3 lines
                const words = addressText.split(' ');
                const wordsPerLine = Math.ceil(words.length / 3);
                
                for (let i = 0; i < 3; i++) {
                    const start = i * wordsPerLine;
                    const end = Math.min(start + wordsPerLine, words.length);
                    if (start < words.length) {
                        addressLines[i] = words.slice(start, end).join(' ');
                    }
                }
            }
            
            // Clear the container
            container.innerHTML = '';
            
            // Create a paragraph for each non-empty line
            addressLines.forEach(line => {
                if (line && line.trim()) {
                    const p = document.createElement('p');
                    p.innerHTML = '<i class="fas fa-map-marker-alt"></i> ' + line;
                    container.appendChild(p);
                }
            });
        }
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    splitAddressIntoLines();
    updateAmountInWords();
});

// Print shortcuts
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && (e.key === 'p' || e.key === 's')) {
        e.preventDefault();
        window.print();
    }
    if (e.key === 'Escape') {
        window.history.back();
    }
});
</script>

</body>
</html>