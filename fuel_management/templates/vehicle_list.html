{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
    .card{max-width:1200px;margin:auto;background:#fff;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
    h1{color:#333}
    .add{background:#4caf50;color:#fff;padding:10px 20px;border-radius:6px;text-decoration:none;font-weight:600}
    .add:hover{background:#45a049}
    table{width:100%;border-collapse:collapse;margin-top:20px}
    th,td{padding:12px 15px;border-bottom:1px solid #ddd;text-align:left}
    th{background:#f8f9fa;font-weight:600;color:#495057}
    tr:hover{background:#f8f9fa}
    .view{background:#28a745;color:#fff;padding:6px 12px;border-radius:4px;text-decoration:none;font-size:14px;margin-right:5px;display:inline-block}
    .view:hover{background:#218838;color:#fff}
    .edit{background:#007bff;color:#fff;padding:6px 12px;border-radius:4px;text-decoration:none;font-size:14px;margin-right:5px;display:inline-block}
    .edit:hover{background:#0069d9;color:#fff}
    .delete{background:#dc3545;color:#fff;padding:6px 12px;border-radius:4px;border:none;font-size:14px;cursor:pointer}
    .delete:hover{background:#c82333}
    .actions{display:flex;gap:5px;flex-wrap:wrap}
    .mileage{font-weight:600;color:#2c5aa0}
    .fuel-rate{font-weight:600;color:#e74c3c}
    .delete-form{display:inline}
    .no-data{text-align:center;padding:40px;color:#6c757d}
    .file-status{color:#6c757d;font-style:italic}
</style>

<div class="container-fluid">
    <div class="card">
        <div class="head">
            <h1>Vehicle Master List</h1>
            <a class="add" href="{% url 'vehicle' %}">
                <i class="fas fa-plus"></i> Add New Vehicle
            </a>
        </div>

        {% if vehicles %}
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Vehicle Number</th>
                        <th>Owner Name</th>
                        <th>Fuel Type</th>
                        <th>Fuel Rate</th>
                        <th>Avg Mileage</th>
                        <th>RC</th>
                        <th>Insurance</th>
                        <th>Pollution</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for v in vehicles %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><strong>{{ v.vehicle_number }}</strong></td>
                        <td>{{ v.owner_name }}</td>
                        <td>{{ v.get_fuel_type_display }}</td>
                        <td class="fuel-rate">â‚¹{{ v.fuel_rate }}</td>
                        <td class="mileage">{{ v.avg_mileage }} km/l</td>
                        <td>
                            {% if v.rc_copy %}
                                <a class="view" href="{{ v.rc_copy.url }}" target="_blank">
                                    <i class="fas fa-eye"></i> View
                                </a>
                            {% else %}
                                <span class="file-status">Not uploaded</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if v.insurance_copy %}
                                <a class="view" href="{{ v.insurance_copy.url }}" target="_blank">
                                    <i class="fas fa-eye"></i> View
                                </a>
                            {% else %}
                                <span class="file-status">Not uploaded</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if v.pollution_copy %}
                                <a class="view" href="{{ v.pollution_copy.url }}" target="_blank">
                                    <i class="fas fa-eye"></i> View
                                </a>
                            {% else %}
                                <span class="file-status">Not uploaded</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="actions">
                                <a class="edit" href="{% url 'vehicle_edit' v.id %}">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <form class="delete-form" method="post" action="{% url 'vehicle_delete' v.id %}" onsubmit="return confirm('Are you sure you want to delete vehicle {{ v.vehicle_number }}? This action cannot be undone.');">
                                    {% csrf_token %}
                                    <button type="submit" class="delete">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="no-data">
            <i class="fas fa-car" style="font-size:48px;color:#dee2e6;margin-bottom:15px;"></i>
            <h3>No Vehicles Found</h3>
            <p>No vehicles have been registered yet. Click the button above to add your first vehicle.</p>
            <a class="add" href="{% url 'vehicle' %}" style="margin-top:15px;">
                <i class="fas fa-plus"></i> Add Your First Vehicle
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Optional: Add sweet alert for delete confirmation instead of default confirm
document.addEventListener('DOMContentLoaded', function() {
    const deleteForms = document.querySelectorAll('.delete-form');
    
    deleteForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            if (!confirm('Are you sure you want to delete this vehicle? This action cannot be undone.')) {
                e.preventDefault();
            }
        });
    });
});
</script>
{% endblock %}