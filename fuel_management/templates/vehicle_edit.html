{% extends "base.html" %}

{% block content %}
<style>
    *{box-sizing:border-box;margin:0;padding:0}
    .vehicle-container{font-family:Segoe UI,Helvetica,Arial,sans-serif;background:#f5f5f5;padding:20px}
    .card{max-width:600px;margin:auto;background:#fff;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .card h1{text-align:center;margin-bottom:25px;color:#333}
    .grp{margin-bottom:20px}
    .grp label{display:block;margin-bottom:6px;font-weight:600;color:#555}
    input[type=text],input[type=file],input[type=number],select{width:100%;padding:12px;border:2px solid #ddd;border-radius:6px;font-size:16px}
    input[type=text]:focus,input[type=file]:focus,input[type=number]:focus,select:focus{outline:none;border-color:#4caf50}
    .upload-area{background:#fafafa;border:2px dashed #ccc;border-radius:8px;padding:20px;margin:25px 0}
    .upload-area h3{text-align:center;margin-bottom:15px;color:#333}
    .file-grp{margin-bottom:15px}
    .optional{color:#666;font-weight:normal;font-size:14px}
    .btn{background:#4caf50;color:#fff;padding:14px 0;border:none;border-radius:6px;font-size:18px;width:100%;cursor:pointer;transition:.3s}
    .btn:hover{background:#45a049}
    .rate-display{background:#e9f7ef;padding:10px;border-radius:4px;margin-top:8px;font-weight:600;color:#2c5aa0}
    .alert{margin-bottom:20px;padding:12px;border-radius:6px}
    .alert-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
    .alert-success{background:#d1edff;color:#155724;border:1px solid #c3e6cb}
    .file-info{background:#f8f9fa;padding:10px;border-radius:4px;margin-top:5px;font-size:14px}
    .checkbox-grp{margin-top:10px}
    .checkbox-grp input{margin-right:8px}
</style>

<div class="vehicle-container">
    <div class="card">
        <h1>Edit Vehicle</h1>
        
        <!-- Display Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="grp">
                <label>Vehicle Number</label>
                <input type="text" value="{{ vehicle.vehicle_number }}" readonly style="background:#f5f5f5;">
                <small style="color:#666;">Vehicle number cannot be changed</small>
            </div>
            <div class="grp">
                <label>Vehicle Name</label>
                <input type="text" name="vehicle_name" value="{{ vehicle.vehicle_name }}" required>
            </div>
            <div class="grp">
                <label>Model Number</label>
                <input type="text" name="model_number" value="{{ vehicle.model_number }}" required>
            </div>
            <div class="grp">
                <label>Manufacture Year</label>
                <input type="number" name="manufacture_year" value="{{ vehicle.manufacture_year }}" min="1900" max="{% now 'Y' %}" required>
            </div>
            <div class="grp">
                <label>Owner Name</label>
                <input type="text" name="owner_name" value="{{ vehicle.owner_name }}" required>
            </div>
            <div class="grp">
                <label>Fuel Type</label>
                <select name="fuel_type" required>
                    <option value="petrol" {% if vehicle.fuel_type == 'petrol' %}selected{% endif %}>Petrol</option>
                    <option value="diesel" {% if vehicle.fuel_type == 'diesel' %}selected{% endif %}>Diesel</option>
                </select>
            </div>
            <div class="grp">
                <label>Average Mileage (km/l)</label>
                <input type="number" name="avg_mileage" step="0.01" min="0" value="{{ vehicle.avg_mileage }}" required>
            </div>

            <div class="upload-area">
                <h3>Document Management</h3>
                
                <div class="file-grp">
                    <label>RC Copy</label>
                    {% if vehicle.rc_copy %}
                        <div class="file-info">
                            <a href="{{ vehicle.rc_copy.url }}" target="_blank">View Current File</a>
                        </div>
                    {% endif %}
                    <input type="file" name="rc_copy" accept=".pdf,.jpg,.jpeg,.png">
                    {% if vehicle.rc_copy %}
                    <div class="checkbox-grp">
                        <input type="checkbox" id="remove_rc_copy" name="remove_rc_copy">
                        <label for="remove_rc_copy" style="font-weight:normal;">Remove current RC copy</label>
                    </div>
                    {% endif %}
                </div>
                
                <div class="file-grp">
                    <label>Insurance Copy</label>
                    {% if vehicle.insurance_copy %}
                        <div class="file-info">
                            <a href="{{ vehicle.insurance_copy.url }}" target="_blank">View Current File</a>
                        </div>
                    {% endif %}
                    <input type="file" name="insurance_copy" accept=".pdf,.jpg,.jpeg,.png">
                    {% if vehicle.insurance_copy %}
                    <div class="checkbox-grp">
                        <input type="checkbox" id="remove_insurance_copy" name="remove_insurance_copy">
                        <label for="remove_insurance_copy" style="font-weight:normal;">Remove current insurance copy</label>
                    </div>
                    {% endif %}
                </div>
                
                <div class="file-grp">
                    <label>Pollution Copy</label>
                    {% if vehicle.pollution_copy %}
                        <div class="file-info">
                            <a href="{{ vehicle.pollution_copy.url }}" target="_blank">View Current File</a>
                        </div>
                    {% endif %}
                    <input type="file" name="pollution_copy" accept=".pdf,.jpg,.jpeg,.png">
                    {% if vehicle.pollution_copy %}
                    <div class="checkbox-grp">
                        <input type="checkbox" id="remove_pollution_copy" name="remove_pollution_copy">
                        <label for="remove_pollution_copy" style="font-weight:normal;">Remove current pollution copy</label>
                    </div>
                    {% endif %}
                </div>
            </div>

            <button type="submit" class="btn">Update Vehicle Details</button>
            <a href="{% url 'vehicle_list' %}" style="display:block;text-align:center;margin-top:15px;color:#666;text-decoration:none;">‚Üê Back to Vehicle List</a>
        </form>
    </div>
</div>
{% endblock %}