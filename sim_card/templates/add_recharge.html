{% extends "base.html" %}
{% block title %}Add Recharge – {{ sim.sim_no }}{% endblock %}
{% block header %}Add Recharge for SIM {{ sim.sim_no }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Add Recharge</h5>
    </div>
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          <label class="form-label">Recharge Date</label>
         <input type="date"
       name="recharge_date"
       class="form-control"
       value="{% now 'Y-m-d' %}"  
       required>
        </div>
        <div class="mb-3">
          <label class="form-label">Amount</label>
          <input type="number" name="amount" class="form-control" step="0.01" required>
        </div>
        <!-- AFTER amount -->
<div class="mb-3">
  <label class="form-label">Validity (days)</label>
  <input type="number"
         name="validity_days"
         id="id_validity_days"
         class="form-control"
         min="0"
         placeholder="e.g. 28">
  <!-- invisible carrier for the calendar date -->
  <input type="hidden"
         name="validity_date"
         id="id_validity_date">
</div>
       <div class="mb-3">
  <label class="form-label">Recharged By</label>
  <select name="recharged_by" class="form-select">
    <option value="" disabled>-- Select User --</option>
    {% for u in users %}
      <option value="{{ u.pk }}" 
              {% if current_user and current_user.pk == u.pk %}selected{% endif %}>
        {{ u.name }}
      </option>
    {% endfor %}
  </select>
</div>
        <div class="mb-3">
          <label class="form-label">Notes</label>
          <textarea name="notes" class="form-control" rows="3"></textarea>
        </div>

        <div class="d-flex justify-content-between">
          <a href="{% url 'sim_recharge_history' sim.id %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back
          </a>
          <button type="submit" class="btn btn-success">
            <i class="bi bi-save"></i> Save Recharge
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
/* identical JS as above – just replace rechargeInp
   with the recharge_date field in this template */
const daysInput = document.getElementById('id_validity_days');
const dateInput = document.getElementById('id_validity_date');
const rDateInp  = document.querySelector('input[name="recharge_date"]');

function calc() {
  const days = parseInt(daysInput.value, 10);
  const rDate = rDateInp.value;
  if (!isNaN(days) && rDate) {
    const d = new Date(rDate);
    d.setDate(d.getDate() + days);
    dateInput.value = d.toISOString().split('T')[0];
  }
}
daysInput.addEventListener('input', calc);
rDateInp.addEventListener('change', calc);
</script>
{% endblock %}
